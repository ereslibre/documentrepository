var characteri=0;var characterlasti=0;var institutioni=0;var institutionlasti=0;var eventi=0;var eventlasti=0;var initial_characters=new Array();var available_characters=new Array();var initial_institutions=new Array();var available_institutions=new Array();var initial_events=new Array();var available_events=new Array();function documentInit(){initial_characters=available_characters.slice();initial_institutions=available_institutions.slice();initial_events=available_events.slice()}function cloneCharacters(){var a=$("#characters").clone();a.each(function(c,b){$("option",this).each(function(){if($.inArray(this.value,available_characters)==-1){$(this).remove()}})});return a}function reloadCharacters(){$.ajax({url:"/index.php/api/characters",success:function(c){var b=JSON.parse(c);var a=new Array();$.each(b,function(d,e){if($.inArray(e.id,initial_characters)==-1){$("#characters").append('<option value="'+e.id+'">'+e.name+"</option>");available_characters.push(e.id)}a.push(e.id)});initial_characters=a;$("#characterwrapper"+(characteri-1)).remove();addCharacterSelection()}})}function addCharacterSelection(){if(!(available_characters.length-1)){return}var b=cloneCharacters();b.attr("id","Document_character"+characteri);b.attr("name","Document[character"+characteri+"]");var a=$('<div id="characterwrapper'+characteri+'" class="characterbox"></div>');a.append(b);a.append('<div class="minwidth" style="display: inline;" id="characterlabel'+characteri+'"></div>');a.append('<div class="action" style="display: none;" id="removecharacter'+characteri+'"><a onclick="removeCharacter('+characteri+');" href="javascript:void(0);">Remove</a></div>');a.append('<div class="action" id="addcharacter'+characteri+'"><a onclick="addCharacter();" href="javascript:void(0);">Add</a></div>');$("#selectedcharacters").append(a);$("#Document_character"+characteri).show();$("#addcharacter"+characteri).show();characterlasti=characteri;++characteri}function updateCharacterSelection(){$("#characterwrapper"+characterlasti).remove();addCharacterSelection()}function addCharacter_(a){if(characteri>0){if(a==""){alert("Please, select the character you want to add");return}$("#Document_character"+characterlasti).val(a);var b;$.each(available_characters,function(d,c){if(c==a){b=d}});available_characters.splice(b,1);$("#Document_character"+characterlasti).hide();$("#addcharacter"+characterlasti).hide();$("#removecharacter"+characterlasti).show();$("#characterlabel"+characterlasti).html($("#Document_character"+characterlasti+" option:selected").text());$("#characterlabel"+characterlasti).attr("character",$("#Document_character"+characterlasti+" option:selected").val());$("#characterlabel"+characterlasti).show()}addCharacterSelection()}function addCharacter(){addCharacter_($("#Document_character"+characterlasti).val())}function removeCharacter(a){available_characters.push($("#characterlabel"+a).attr("character"));$("#characterwrapper"+a).remove();if(available_characters.length==2){addCharacterSelection()}else{updateCharacterSelection()}}function cloneInstitutions(){var a=$("#institutions").clone();a.each(function(c,b){$("option",this).each(function(){if($.inArray(this.value,available_institutions)==-1){$(this).remove()}})});return a}function reloadInstitutions(){$.ajax({url:"/index.php/api/institutions",success:function(b){var c=JSON.parse(b);var a=new Array();$.each(c,function(d,e){if($.inArray(e.id,initial_institutions)==-1){$("#institutions").append('<option value="'+e.id+'">'+e.name+"</option>");available_institutions.push(e.id)}a.push(e.id)});initial_institutions=a;$("#institutionwrapper"+(institutioni-1)).remove();addInstitutionSelection()}})}function addInstitutionSelection(){if(!(available_institutions.length-1)){return}var a=cloneInstitutions();a.attr("id","Document_institution"+institutioni);a.attr("name","Document[institution"+institutioni+"]");var b=$('<div id="institutionwrapper'+institutioni+'" class="characterbox"></div>');b.append(a);b.append('<div class="minwidth" style="display: inline;" id="institutionlabel'+institutioni+'"></div>');b.append('<div class="action" style="display: none;" id="removeinstitution'+institutioni+'"><a onclick="removeInstitution('+institutioni+');" href="javascript:void(0);">Remove</a></div>');b.append('<div class="action" id="addinstitution'+institutioni+'"><a onclick="addInstitution();" href="javascript:void(0);">Add</a></div>');$("#selectedinstitutions").append(b);$("#Document_institution"+institutioni).show();$("#addinstitution"+institutioni).show();institutionlasti=institutioni;++institutioni}function updateInstitutionSelection(){$("#institutionwrapper"+institutionlasti).remove();addInstitutionSelection()}function addInstitution_(a){if(institutioni>0){if(a==""){alert("Please, select the institution you want to add");return}$("#Document_institution"+institutionlasti).val(a);var b;$.each(available_institutions,function(d,c){if(c==a){b=d}});available_institutions.splice(b,1);$("#Document_institution"+institutionlasti).hide();$("#addinstitution"+institutionlasti).hide();$("#removeinstitution"+institutionlasti).show();$("#institutionlabel"+institutionlasti).html($("#Document_institution"+institutionlasti+" option:selected").text());$("#institutionlabel"+institutionlasti).attr("institution",$("#Document_institution"+institutionlasti+" option:selected").val());$("#institutionlabel"+institutionlasti).show()}addInstitutionSelection()}function addInstitution(){addInstitution_($("#Document_institution"+institutionlasti).val())}function removeInstitution(a){available_institutions.push($("#institutionlabel"+a).attr("institution"));$("#institutionwrapper"+a).remove();if(available_institutions.length==2){addInstitutionSelection()}else{updateInstitutionSelection()}}function cloneEvents(){var a=$("#events").clone();a.each(function(c,b){$("option",this).each(function(){if($.inArray(this.value,available_events)==-1){$(this).remove()}})});return a}function reloadEvents(){$.ajax({url:"/index.php/api/events",success:function(c){var a=JSON.parse(c);var b=new Array();$.each(a,function(d,e){if($.inArray(e.id,initial_events)==-1){$("#events").append('<option value="'+e.id+'">'+e.name+"</option>");available_events.push(e.id)}b.push(e.id)});initial_events=b;$("#eventwrapper"+(eventi-1)).remove();addEventSelection()}})}function addEventSelection(){if(!(available_events.length-1)){return}var b=cloneEvents();b.attr("id","Document_event"+eventi);b.attr("name","Document[event"+eventi+"]");var a=$('<div id="eventwrapper'+eventi+'" class="characterbox"></div>');a.append(b);a.append('<div class="minwidth" style="display: inline;" id="eventlabel'+eventi+'"></div>');a.append('<div class="action" style="display: none;" id="removeevent'+eventi+'"><a onclick="removeEvent('+eventi+');" href="javascript:void(0);">Remove</a>');a.append('<div class="action" id="addevent'+eventi+'" onclick="addEvent();"><a href="javascript:void(0);">Add</a>');$("#selectedevents").append(a);$("#Document_event"+eventi).show();$("#addevent"+eventi).show();eventlasti=eventi;++eventi}function updateEventSelection(){$("#eventwrapper"+eventlasti).remove();addEventSelection()}function addEvent_(a){if(eventi>0){if(a==""){alert("Please, select the event you want to add");return}$("#Document_event"+eventlasti).val(a);var b;$.each(available_events,function(d,c){if(c==a){b=d}});available_events.splice(b,1);$("#Document_event"+eventlasti).hide();$("#addevent"+eventlasti).hide();$("#removeevent"+eventlasti).show();$("#eventlabel"+eventlasti).html($("#Document_event"+eventlasti+" option:selected").text());$("#eventlabel"+eventlasti).attr("event",$("#Document_event"+eventlasti+" option:selected").val());$("#eventlabel"+eventlasti).show()}addEventSelection()}function addEvent(){addEvent_($("#Document_event"+eventlasti).val())}function removeEvent(a){available_events.push($("#eventlabel"+a).attr("event"));$("#eventwrapper"+a).remove();if(available_events.length==2){addEventSelection()}else{updateEventSelection()}};